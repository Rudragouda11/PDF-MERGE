<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Merge & Split Pro</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
  header { background: #4285f4; color: white; padding: 20px; width: 100%; text-align: center; font-size: 24px; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
  main { max-width: 800px; width: 95%; margin-top: 30px; }
  .tabs { display: flex; justify-content: center; margin-bottom: 20px; }
  .tab-btn { flex: 1; padding: 12px 0; cursor: pointer; border: none; background: #ddd; font-weight: bold; transition: 0.3s; }
  .tab-btn.active { background: #4285f4; color: white; }
  .tab-content { display: none; flex-direction: column; align-items: center; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  .tab-content.active { display: flex; }
  input[type="file"] { margin: 10px 0; padding: 10px; font-size: 16px; cursor: pointer; }
  .drop-zone { border: 2px dashed #bbb; padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 15px; color: #555; transition: 0.3s; }
  .drop-zone.dragover { border-color: #4285f4; background: #e3f0ff; color: #000; }
  button { padding: 12px 20px; font-size: 16px; margin: 10px 0; cursor: pointer; border: none; background: #4285f4; color: white; border-radius: 5px; transition: 0.3s; }
  button:hover { background: #306fd0; }
  ul { list-style: none; padding: 0; margin-top: 10px; width: 100%; }
  li { padding: 8px 12px; background: #f5f5f5; margin-bottom: 5px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; cursor: grab; }
  li.dragging { opacity: 0.5; }
  a.download-link { color: #4285f4; text-decoration: none; font-weight: bold; }
  progress { width: 100%; margin-top: 10px; height: 18px; border-radius: 5px; }
</style>
</head>
<body>

<header>PDF Merge & Split Pro</header>

<main>
  <div class="tabs">
    <button class="tab-btn active" data-tab="merge">Merge PDFs</button>
    <button class="tab-btn" data-tab="split">Split PDF</button>
  </div>

  <!-- Merge Section -->
  <div class="tab-content active" id="merge">
    <div class="drop-zone" id="mergeDrop">Drag & drop PDFs here or click to select</div>
    <input type="file" id="mergeFiles" multiple accept="application/pdf" style="display:none;">
    <ul id="mergeList"></ul>
    <button id="mergeBtn">Merge PDFs</button>
    <progress id="mergeProgress" value="0" max="100" style="display:none;"></progress>
  </div>

  <!-- Split Section -->
  <div class="tab-content" id="split">
    <div class="drop-zone" id="splitDrop">Drag & drop a PDF here or click to select</div>
    <input type="file" id="splitFile" accept="application/pdf" style="display:none;">
    <ul id="splitList"></ul>
    <button id="splitBtn">Split PDF</button>
    <progress id="splitProgress" value="0" max="100" style="display:none;"></progress>
  </div>
</main>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script>
// Tabs
const tabBtns = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');
tabBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    tabBtns.forEach(b => b.classList.remove('active'));
    tabContents.forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

// Helper for drag & drop
function setupDropZone(dropZone, input, fileListArray, ulElement) {
  dropZone.addEventListener('click', () => input.click());
  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
  dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.classList.remove('dragover'); });
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
    fileListArray.push(...files);
    renderFileList(fileListArray, ulElement);
  });
  input.addEventListener('change', () => {
    const files = Array.from(input.files);
    fileListArray.push(...files);
    renderFileList(fileListArray, ulElement);
  });
}

function renderFileList(files, ul) {
  ul.innerHTML = '';
  files.forEach((file, idx) => {
    const li = document.createElement('li');
    li.textContent = `${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
    li.draggable = true;
    li.dataset.index = idx;
    ul.appendChild(li);
  });
}

// Drag reorder
function enableReorder(ul, files) {
  let dragSrcEl = null;
  ul.addEventListener('dragstart', e => { dragSrcEl = e.target; e.target.classList.add('dragging'); });
  ul.addEventListener('dragend', e => { e.target.classList.remove('dragging'); });
  ul.addEventListener('dragover', e => { e.preventDefault(); });
  ul.addEventListener('drop', e => {
    e.preventDefault();
    if(e.target.tagName === 'LI' && dragSrcEl){
      const srcIndex = dragSrcEl.dataset.index;
      const tgtIndex = e.target.dataset.index;
      [files[srcIndex], files[tgtIndex]] = [files[tgtIndex], files[srcIndex]];
      renderFileList(files, ul);
      enableReorder(ul, files);
    }
  });
}

// Merge PDFs
const mergeFiles = [];
const mergeDrop = document.getElementById('mergeDrop');
const mergeInput = document.getElementById('mergeFiles');
const mergeList = document.getElementById('mergeList');
const mergeBtn = document.getElementById('mergeBtn');
const mergeProgress = document.getElementById('mergeProgress');
setupDropZone(mergeDrop, mergeInput, mergeFiles, mergeList);
enableReorder(mergeList, mergeFiles);

mergeBtn.addEventListener('click', async () => {
  if (mergeFiles.length < 2) { alert('Select at least 2 PDFs'); return; }
  mergeProgress.style.display = 'block';
  mergeProgress.value = 0;
  const mergedPdf = await PDFLib.PDFDocument.create();
  for (let i=0;i<mergeFiles.length;i++) {
    const file = mergeFiles[i];
    if(file.size > 100*1024*1024){ alert(`${file.name} > 100MB skipped.`); continue; }
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
    pages.forEach(p => mergedPdf.addPage(p));
    mergeProgress.value = Math.round(((i+1)/mergeFiles.length)*100);
  }
  const mergedBytes = await mergedPdf.save();
  const blob = new Blob([mergedBytes], {type:'application/pdf'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'merged.pdf';
  a.click();
  mergeProgress.style.display = 'none';
});

// Split PDF
const splitFiles = [];
const splitDrop = document.getElementById('splitDrop');
const splitInput = document.getElementById('splitFile');
const splitList = document.getElementById('splitList');
const splitBtn = document.getElementById('splitBtn');
const splitProgress = document.getElementById('splitProgress');
setupDropZone(splitDrop, splitInput, splitFiles, splitList);

splitBtn.addEventListener('click', async () => {
  const file = splitInput.files[0];
  if(!file){ alert('Select a PDF'); return; }
  if(file.size > 100*1024*1024){ alert('File > 100MB'); return; }
  splitProgress.style.display = 'block';
  splitProgress.value = 0;
  const arrayBuffer = await file.arrayBuffer();
  const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
  splitList.innerHTML = '';
  const pageCount = pdf.getPageCount();
  for(let i=0;i<pageCount;i++){
    const newPdf = await PDFLib.PDFDocument.create();
    const [copied] = await newPdf.copyPages(pdf,[i]);
    newPdf.addPage(copied);
    const bytes = await newPdf.save();
    const blob = new Blob([bytes], {type:'application/pdf'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${file.name.replace('.pdf','')}_page_${i+1}.pdf`;
    a.textContent = `Download page ${i+1}`;
    a.classList.add('download-link');
    const li = document.createElement('li');
    li.appendChild(a);
    splitList.appendChild(li);
    splitProgress.value = Math.round(((i+1)/pageCount)*100);
  }
  splitProgress.style.display = 'none';
});
</script>

</body>
</html>
